Active Directory Light Weight Directory Service
===============================================
Active Directory Light Weight Directory Service（以下、ADLDS）の
仕様と動作について記載する。  

AD LDSとは
----------
* フォレスト、ドメインやドメインコントローラーといった概念は存在しない。
* ドメインコントローラーやドメインネームシステム（DNS）は不要。
* １台のコンピュータ上に複数のAD LDSインスタンスを実行でき、各インスタンス個別にスキーマを管理できる。
* AD LDSでは、ユーザおよびグループに与えられているアクセス許可に基づいて、ディレクトリデータへのアクセスが制御される。
* http://technet.microsoft.com/ja-jp/library/cc754361(v=ws.10).aspx


インスタンスの操作
------------------
# AD LDSインスタンス
* AD LDSインスタンスには、個別のディレクトリデータストア、一意のサービス名、およびインストール時に割り当てられる一意のサービスの説明がある。
* AD LDSはディレクトリユーザの認証、データ要求の処理、ディレクトリサーバ間のデータ同期（マルチマスターレプリケーション）、データ管理を提供する。

# AD LDSスキーマ
* オブジェクト指向のようにオブジェクトのクラスと属性を使用して、AD LDSディレクトリに作成して格納できるオブジェクトおよびデータの種類を定義する。

# AD LDSレプリケーションおよび構成セット
* レプリケーション方式には、マルチマスターレプリケーションが用いられる。
* 同一のディレクトリパーティションを持つAD LDSインスタンスは、構成セットと呼ばれる論理グループを形成する。
* 一方のAD LDSに更新が発生すると、他のAD LDSインスタンスと一時的に不整合となるが、構成セットを通じてレプリケートされることで最新データに収束する。
* 同じ構成セットに参加している全てのAD LDSインスタンスでは、共通の構成ディレクトリパーティションおよび共通のスキーマディレクトリパーティションがレプリケートされる必要がある。
* ただし、構成セットにある全てのアプリケーションディレクトリパーティションがレプリケートされる必要はない。
* 構成セットへの参加は、AD LDSインスタンスのインストール時のみ可能


# レプリケーションの競合回避
* 2つの異なるAD LDSインスタンスにある同じディレクトリパーティションの同じデータに変更を加えた場合、レプリケート時に競合が発生する。競合の解決するために、競合する変更を受信したレプリケーション パートナーは、各変更に含まれている属性データ (バージョンとタイム スタンプ) を調べます。AD LDS インスタンスは、バージョンが高い方の変更を受け付け、もう一方の変更は破棄します。バージョンが等しい場合、AD LDS インスタンスは、タイム スタンプが新しい方の変更を受け付けます。
オブジェクトの複数値属性の 2 つ以上の値が、2 つの異なる AD LDS インスタンス上で同時に更新された場合、更新された値のうち 1 つだけがレプリケートされます。つまり、2 つの異なる AD LDS インスタンスで複数値属性が同時に更新されると、更新が複数値属性内の異なる値に適用される場合でも、競合と見なされます。この規則の例外は、リンクされた値属性 (グループ メンバーシップなど) です。リンクされた値属性内の異なる値は同時に更新できます。

# レプリケーショントポロジ
* 知識整合性チェッカー（KCC）が、各インスタンスの一部として実行されるプロセスで、ネットワークに基づいてレプリケーショントラフィックの移動に最も効率的なトポロジを自動的に構築する。
* KCCは定期的にレプリケーショントポロジを再計算し、環境内で発生したネットワークの変更に合わせて調整される。

# レプリケーションのセキュリティ確保
* 構成セット内のレプリケーション認証に使用される方法は、構成ディレクトリパーティションのmsDS-ReplAuthenticationMode属性の値によって異なる。
* レプリケーションパートナーが正常に認証されると2つのパートナー間の全てのレプリケーショントラフィックは暗号化される。

# AD LDSのバックアップ
* 各インスタンスでは、adamntds.ditというデータベースファイルと、その関連ログファイルが%program files%\Microsoft adam\<インスタンス名>\data に保存される。
* http://technet.microsoft.com/ja-jp/library/cc772252.aspx

# AD LDSの復元
* 復元にはAD LDSインスタンスの停止と復元処理が必要。
* 復元処理の前に既存データベースおよびログファイルをAD LDSインスタンスから移動（または削除）してから復元処理を行う。
* 復元処理には「Authoritative Restore」を実行する。
* データを復元してからAD LDSインスタンスを再起動するまでの間に、dsdbutilユーティリティを実行する。
* dsdbutilユーティリティにより、ディレクトリオブジェクトをAuthoritative Restore用にマークできる。
* オブジェクトがAuthoritative Restoreとしてマークされているとき、構成セット内にあるその他の更新シーケンス番号よりも大きくなるように変更されるため、構成セット全体に正しくレプリケートされる。
* http://technet.microsoft.com/ja-jp/library/cc732853.aspx

# Ldp.exeを使用してAD LDSインスタンスを管理する
* http://technet.microsoft.com/ja-jp/library/cc754970.aspx

# AD LDSインスタンスにデータをインポートする。
* ldifde ユーティリティの使用
* http://technet.microsoft.com/ja-jp/library/cc753447.aspx

# 構成セットの管理
* ADSIエディタを用いて、構成、スキーマパーティションを見ることは可能
* http://technet.microsoft.com/ja-jp/library/cc753937(v=ws.10).aspx


ディレクトリパーティションの操作
--------------------------------
* 名前付けコンテキストと呼ばれる論理ディレクトリパーティションにAD LDSディレクトリストアは編成される。
* ディレクトリパーティションには、構成、スキーマ、アプリケーションの3種類が存在する。
* 各AD LDSディレクトリストアには、構成ディレクトパーティション、スキーマディレクトリパーティションが1つずつ含まれている必要がある。
* アプリケーションディレクトリパーティションは含まれていなくても1つ以上含まれていてもよい。
* アプリケーションディレクトリパーティションは新しいAD LDSインスタンス作成中、または作成後の任意の時点で作成可能。

# ディレクトリ パーティションとは
* AD LDSではディレクトリ データを階層的なファイル ベースのディレクトリ ストアに格納します。既定では、特定の AD LDS インスタンスのディレクトリ ストアは、次のファイルとなる。
* %ProgramFiles%\Microsoft ADAM\<インスタンス名>\data\adamntds.dit
* AD LDSディレクトリストアは、論理ディレクトリパーティション（名前付けコンテキスト）に編成される。
* 構成、スキーマディレクトリパーティションは必須
* アプリケーションディレクトリパーティションは任意
* 構成パーティション、スキーマパーティションは同じ構成設定に属するAD LDSサービスインスタンスにレプリケートされる。
* 構成、スキーマパーティションはインストール中に自動的に作成される。


# 構成ディレクトリパーティション
* 識別名は、CN=Configuration,CN={<GUID>}
* AD LDS構成情報を持つ。必須のパーティション。

# スキーマディレクトリパーティション
* 識別名は、CN=Schema,CN=Configuration,CN={<GUID>}
* ディレクトリ ストアが保持できるデータ型の定義が格納される。スキーマ パーティションの定義に依存して、データの整合性を維持します。さらに、AD LDS インスタンスで許可されるデータ型を特定するために、アプリケーションがスキーマ パーティションを参照することもできます。AD LDS が特定のアプリケーションに固有のデータを保持できるよう、スキーマを拡張することもできます。
* 必須のパーティションとなる。

# アプリケーションディレクトリパーティション
* 識別名は、パーティション作成時に割り当てられる。
* AD LDSのセットアップ中、またはインストール後の任意の時点で作成可能。
* 一般的には、アプリケーションを介して、指定のアプリケーションディレクトリパーティションのデータを管理します。
* アプリケーションディレクトリパーティション作成後、AD LDSではアプリケーションパーティションの参照オブジェクトがCN=Partitions,CN=Configuration に格納されます。
* http://technet.microsoft.com/ja-jp/library/cc770970.aspx

# ディレクトリパーティションの管理
* AD LDS ディレクトリ パーティションはすべて、一意の識別名を持ちます。
* AD LDS 管理ツールを使用して、AD LDS 構成ディレクトリ パーティションとスキーマ ディレクトリ パーティションを表示および管理できます。このツールは、AD LDS セットアップ中にインストールされます。アプリケーション ディレクトリ パーティションの管理には通常、ディレクトリ対応アプリケーションを使用します。
* スキーマ ディレクトリ パーティションと構成ディレクトリ パーティションは、AD LDS インスタンスのインストール中に自動的に作成されます (これらのディレクトリ パーティションを作成できるのは、AD LDS のインストール中のみです)。イ
* スキーマ ディレクトリ パーティションやアプリケーション ディレクトリ パーティションとの間でディレクトリ オブジェクトのインポートとエクスポートに使用できるメソッドは多数あります。.ldf ファイルのインポートとエクスポートには、ldifde コマンド ライン ツールを使用できます。.csv (コンマ区切り) ファイルのインポートとエクスポートには、csvde コマンド ライン ツールを使用できます。
* http://technet.microsoft.com/ja-jp/library/cc731668.aspx

# アプリケーションディレクトリパーティションの作成
* http://technet.microsoft.com/ja-jp/library/cc755251.aspx


認証とアクセス制御の操作
------------------------
# AD LDSユーザとグループ
* http://technet.microsoft.com/ja-jp/library/cc732460.aspx


AD LDSインスタンスの作成
------------------------
* http://technet.microsoft.com/ja-jp/library/cc725619(v=ws.10).aspx


AD LDS管理ツールを使用した演習
------------------------------
* http://technet.microsoft.com/ja-jp/library/cc732675(v=ws.10).aspx


AD LDSレプリケーション
----------------------
# repadmin コマンド
* http://technet.microsoft.com/en-us/library/58236d76-5184-46a0-8402-701fe608cf5a

* http://technet.microsoft.com/ja-jp/library/cc731246(v=ws.10).aspx
* http://technet.microsoft.com/ja-jp/library/cc753937(v=ws.10).aspx


SSLバインドの無効化
-------------------
* http://technet.microsoft.com/ja-jp/library/cc731759(v=ws.10).aspx


AD LDS監査
----------
* http://technet.microsoft.com/en-us/library/cc754361(v=ws.10).aspx


http://technet.microsoft.com/ja-jp/library/cc731037.aspx
